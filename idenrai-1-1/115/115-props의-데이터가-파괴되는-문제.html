
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>props의 데이터가 파괴되는 문제</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">props의 데이터가 파괴되는 문제</h2>
                                <div class="box-info">
                                    <p class="category">Tech/React.js</p>
                                    <p class="date">2017-02-08 19:29:46</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p>예전에 자작 데이터테이블에 Add Row버튼을 달아 두고,</p><p>클릭시 테이블 최하단에 줄을 추가하는 작업을 해 두었다.</p><p>추가할 줄의 내용은 다음과 같이 data에 미리 설정해두고 props로 받아서 사용하고 있었다.</p><p><br /></p><div class="colorscripter-code" style="color:#010101; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important; overflow:auto"><table class="colorscripter-code-table" style="margin:0; padding:0; border:none; background-color:#fafafa; border-radius:4px;" cellspacing="0" cellpadding="0"><tbody><tr><td style="padding:6px; border-right:2px solid #e5e5e5"><div style="margin:0; padding:0; word-break:normal; text-align:right; color:#666; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div></div></td><td style="padding:6px 0"><div style="margin:0; padding:0; color:#010101; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">...</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">additionalRow:&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#066de2">name</span>:&nbsp;<span style="color:#63a35c">'AdditionalRow'</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;jname:&nbsp;<span style="color:#63a35c">'追加行'</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;kname:&nbsp;<span style="color:#63a35c">'추가행'</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;calories:&nbsp;<span style="color:#63a35c">''</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;fat:&nbsp;<span style="color:#63a35c">''</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;carbs:&nbsp;<span style="color:#63a35c">''</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;protein:&nbsp;<span style="color:#63a35c">''</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;sodium:&nbsp;<span style="color:#63a35c">''</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;calcium:&nbsp;<span style="color:#63a35c">''</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;iron:&nbsp;<span style="color:#63a35c">''</span>,</div><div style="padding:0 6px; white-space:pre; line-height:130%">},</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">...</div></div></td><td style="vertical-align:bottom; padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="color: white;"><span style="font-size: 9px; word-break: normal; background-color: rgb(229, 229, 229); border-radius: 10px; padding: 1px;">cs</span></a></td></tr></tbody></table></div><p><br /></p><p>근데 이 데이터테이블에 TextField를 만들어, 추가할 줄의 내용을 수정하려 하는 것에서 문제가 발생했다.</p><p>한 항목의 내용을 바꾸면, 행 추가를 통해 만들어진 다른 행도 똑같이 바뀌어버리는 것이다.</p><p><br /></p><p style="text-align: left; clear: none; float: none;"><figure class="imageblock alignCenter" width="638" height="451" filename="s.png" filemime="image/jpeg">
    <span data-lightbox="lightbox">
        <img src="./img/s.png" width="638" height="451" filename="s.png" filemime="image/jpeg" />
    </span>
    <figcaption></figcaption>
</figure></p><p><br /></p><p>이유는 당연히 react의 key 문제.</p><p>데이터로 받아온 다른 줄의 경우는, 다 data.id를 row의 key로 사용하고 있지만...</p><p>나중에 추가한 줄의 경우는 딱히 데이터 id가 존재하지 않기에, 동일한 줄로 인식해버리는 것이다.</p><p><br /></p><p>그래서 일단 넣어 본 코드가 이거였는데...</p><p><br /></p><div class="colorscripter-code" style="color:#010101; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important; overflow:auto"><table class="colorscripter-code-table" style="margin:0; padding:0; border:none; background-color:#fafafa; border-radius:4px;" cellspacing="0" cellpadding="0"><tbody><tr><td style="padding:6px; border-right:2px solid #e5e5e5"><div style="margin:0; padding:0; word-break:normal; text-align:right; color:#666; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div></div></td><td style="padding:6px 0"><div style="margin:0; padding:0; color:#010101; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">addRowButtonClick&nbsp;<span style="color:#a71d5d">=</span>&nbsp;(<span style="color:#066de2">event</span>)&nbsp;<span style="color:#a71d5d">=</span><span style="color:#a71d5d">&gt;</span>&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#066de2">event</span>.preventDefault();</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;const&nbsp;rows&nbsp;<span style="color:#a71d5d">=</span>&nbsp;this.state.rows;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;const&nbsp;additionalRow&nbsp;<span style="color:#a71d5d">=</span>&nbsp;this.props.data.additionalRow;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">if</span>&nbsp;(<span style="color:#a71d5d">!</span>additionalRow)&nbsp;<span style="color:#a71d5d">return</span>;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;additionalRow.id&nbsp;<span style="color:#a71d5d">=</span>&nbsp;uuid();</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;rows.push(additionalRow);</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;this.setState({&nbsp;rows&nbsp;});</div><div style="padding:0 6px; white-space:pre; line-height:130%">}</div></div><div style="text-align:right; margin-top:-13px; margin-right:5px; font-size:9px; font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color: rgb(229, 229, 229);">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom; padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="color: white;"><span style="font-size: 9px; word-break: normal; background-color: rgb(229, 229, 229); border-radius: 10px; padding: 1px;">cs</span></a></td></tr></tbody></table></div><p><br /></p><p>additionalRow를 props에서 받아와 여기의 id에 uuid를 집어넣으면</p><p>버튼 클릭시마다 새로이 uuid가 발급되어, 각기 다른 id가 붙여질 것이라는 생각이었다.</p><p>그런데 이상하게도 key가 동일하다며 줄이 추가되질 않더라.</p><p><br /></p><p style="text-align: left; clear: none; float: none;"><figure class="imageblock alignCenter" width="440" height="82" filename="w.png" filemime="image/jpeg">
    <span data-lightbox="lightbox">
        <img src="./img/w.png" width="440" height="82" filename="w.png" filemime="image/jpeg" />
    </span>
    <figcaption></figcaption>
</figure></p><p style="text-align: left; clear: none; float: none;"><br /></p><p>새로이 지정한 additionalRow의 id에 uuid를 넣는 순간,</p><p>props의 additionalRow의 내용도 동일하게 바뀌는 것이다!</p><p><br /></p><p>그냥 변수 지정을 하는 것은 props의 주소값만 떼오는 형식이기에 원본 props의 내용이 파괴되어버렸고,</p><p>그래서 무조건 모든 줄의 id가 나중에 지정한 uuid로 바뀌어버려서</p><p>2줄 이상의 addRow가 불가능하게 되었다.</p><p><br /></p><p>그래서 찾아본 것이 원본 props의 데이터를 제대로 복제하는 방법이었고...</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Cloning_an_object" target="_blank" class="tx-link">Object.assign()</a> 으로 해결되었다.</p><p><br /></p><div class="colorscripter-code" style="color:#010101; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important; overflow:auto"><p></p><div class="colorscripter-code" style="overflow: auto; position: relative !important;"></div><p></p><table class="colorscripter-code-table" style="margin:0; padding:0; border:none; background-color:#fafafa; border-radius:4px;" cellspacing="0" cellpadding="0"><tbody><tr><td style="padding:6px; border-right:2px solid #e5e5e5"><div style="margin:0; padding:0; word-break:normal; text-align:right; color:#666; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div></div></td><td style="padding:6px 0"><div style="margin:0; padding:0; color:#010101; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">addRowButtonClick&nbsp;<span style="color:#a71d5d">=</span>&nbsp;(<span style="color:#066de2">event</span>)&nbsp;<span style="color:#a71d5d">=</span><span style="color:#a71d5d">&gt;</span>&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#066de2">event</span>.preventDefault();</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;const&nbsp;rows&nbsp;<span style="color:#a71d5d">=</span>&nbsp;this.state.rows;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">if</span>&nbsp;(<span style="color:#a71d5d">!</span>this.props.data.additionalRow)&nbsp;<span style="color:#a71d5d">return</span>;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;const&nbsp;additionalRow&nbsp;<span style="color:#a71d5d">=</span>&nbsp;assign({},&nbsp;this.props.data.additionalRow);</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;const&nbsp;id&nbsp;<span style="color:#a71d5d">=</span>&nbsp;uuid();</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;rows.push(assign(additionalRow,&nbsp;{&nbsp;id&nbsp;}));</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;this.setState({&nbsp;rows&nbsp;});</div><div style="padding:0 6px; white-space:pre; line-height:130%">}</div></div><div style="text-align:right; margin-top:-13px; margin-right:5px; font-size:9px; font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#e5e5e5; text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom; padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none; color:white"><span style="font-size:9px; word-break:normal; background-color:#e5e5e5; color:white; border-radius:10px; padding:1px">cs</span></a></td></tr></tbody></table></div><p><br /></p><p>{}와 props의 additionalRow를 assign시켜서</p><p>새로이 지정된 {}에 additionalRow를 덮어씌워, 완전한 복제를 만들 수 있었다.</p><p>이후 복제품에 uuid를 바르고, 테이블 row data에 push하는 것으로 완료.</p><p>기왕 assign을 쓰는 김에, additionalRow에 id를 넣는 방법도 바꾸어 보았다.</p>
                        </div>
                        <br/>
                        <div class="tags">
                            #key #assign #react 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
