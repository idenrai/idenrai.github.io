---
import { getCollection } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';
import PostCard from '../../components/PostCard.astro';

const allPosts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// íƒœê·¸ ëª©ë¡
const allTags = [...new Set(allPosts.flatMap((p) => p.data.tags))].sort();

// URL ì¿¼ë¦¬ì—ì„œ íƒœê·¸ í•„í„°
const filterTag = Astro.url.searchParams.get('tag');
const posts = filterTag
  ? allPosts.filter((p) => p.data.tags.includes(filterTag))
  : allPosts;
---

<PageLayout title="ë¸”ë¡œê·¸" description="ê°œë°œí•˜ë©´ì„œ ë°°ìš´ ê²ƒë“¤ì„ ê¸°ë¡í•©ë‹ˆë‹¤.">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 py-12">
      <div class="flex items-end justify-between mb-10">
        <div>
          <h1 class="text-3xl font-extrabold text-gray-900 dark:text-gray-50 mb-2">ë¸”ë¡œê·¸</h1>
          <p class="text-gray-500 dark:text-gray-500 text-sm">
            ì´ {allPosts.length}ê°œì˜ ê¸€
          </p>
        </div>
      </div>

      <!-- íƒœê·¸ í•„í„° -->
      {allTags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-8">
          <a
            href="/blog"
            class:list={[
              'px-3 py-1 rounded-full text-sm font-medium transition-colors',
              !filterTag
                ? 'bg-accent-600 text-white'
                : 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700',
            ]}
          >
            ì „ì²´ ({allPosts.length})
          </a>
          {allTags.map((tag) => {
            const count = allPosts.filter((p) => p.data.tags.includes(tag)).length;
            return (
              <a
                href={`/blog?tag=${encodeURIComponent(tag)}`}
                class:list={[
                  'px-3 py-1 rounded-full text-sm font-medium transition-colors',
                  filterTag === tag
                    ? 'bg-accent-600 text-white'
                    : 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700',
                ]}
              >
                {tag} ({count})
              </a>
            );
          })}
        </div>
      )}

      <!-- í¬ìŠ¤íŠ¸ ëª©ë¡ -->
      {posts.length > 0 ? (
        <div class="grid gap-4">
          {posts.map((post) => (
            <PostCard
              title={post.data.title}
              description={post.data.description}
              date={post.data.date}
              tags={post.data.tags}
              slug={post.slug}
            />
          ))}
        </div>
      ) : (
        <div class="text-center py-20 text-gray-400 dark:text-gray-600">
          <p class="text-4xl mb-4">ğŸ”</p>
          <p>í•´ë‹¹ íƒœê·¸ì˜ í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
      )}
    </div>
</PageLayout>
