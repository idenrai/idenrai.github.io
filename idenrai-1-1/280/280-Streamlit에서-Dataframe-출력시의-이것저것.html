
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>Streamlit에서 Dataframe 출력시의 이것저것</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">Streamlit에서 Dataframe 출력시의 이것저것</h2>
                                <div class="box-info">
                                    <p class="category">Tech/Streamlit</p>
                                    <p class="date">2023-11-24 14:14:26</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <h2>st.dataframe</h2>
<p>Streamlit에서는 기본적으로 데이터프레임 출력 기능이 있다.<br><a href="https://docs.streamlit.io/library/api-reference/data/st.dataframe">st.dataframe</a></p>
<pre><code class="language-python">st.dataframe(df)</code></pre>
<h3>단점</h3>
<p>이걸 쓰기만 해도 화면에 맞추어 데이터프레임을 출력해주며, 확대도 가능한데...<br>아쉬운 점이 있다.</p>
<ol>
<li>데이터 내용 전체 표시<br>linebreak의 적용이 안되어, 한눈에 데이터를 보기 어렵다</li>
<li>데이터 내의 url 링크<br>url이 있어도 문자열로 인식하므로 링크 부여 불가</li>
</ol>
<p>이 두가지 문제를 해결하기 위해서는 다른 방법으로 데이터프레임을 출력할 수밖에 없다.</p>
<h2>to_html</h2>
<p>간단히 말하자면 데이터프레임을 html로 변환해서 markdown으로 출력하는 것.</p>
<p><a href="https://docs.streamlit.io/library/api-reference/text/st.markdown">st.markdown</a></p>
<p>구체적인 출력 방식은 아래와 같다.</p>
<pre><code class="language-python">st.markdown(df.to_html(render_links=True, escape=False), unsafe_allow_html=True)</code></pre>
<h3>참조</h3>
<h4>column linebreak</h4>
<p><a href="https://discuss.streamlit.io/t/how-to-display-long-text-in-streamlit-dataframes-with-automatic-line-breaks/41225">https://discuss.streamlit.io/t/how-to-display-long-text-in-streamlit-dataframes-with-automatic-line-breaks/41225</a></p>
<h4>url link</h4>
<p><a href="https://discuss.streamlit.io/t/how-to-display-a-clickable-link-pandas-dataframe/32612/3">https://discuss.streamlit.io/t/how-to-display-a-clickable-link-pandas-dataframe/32612/3</a></p>
<h3>단점</h3>
<p>markdown html 자체가 일단 건드리기가 쉽지 않은 관계로, 몇가지 문제가 발생한다.<br>일단 내가 신경쓰였던 것은 아래와 같다.</p>
<ol>
<li>첫번째 칼럼이 라인 수를 의미하는데, 0부터 시작</li>
<li>칼럼 width 조정이 안됨</li>
<li>url 칼럼이 무의미하게 많은 칸을 차지함</li>
</ol>
<p>(2, 3의 문제는 내가 현재 운용하는 환경에서 특수하게 발생하는 것일 수도 있음)</p>
<p>여하튼 각각 해결책이 있긴 하다.</p>
<h4>첫번째 칼럼 문제</h4>
<p>아래와 같이 style을 넣어서 해결</p>
<pre><code class="language-python">st.markdown(
    &quot;&quot;&quot;
        &lt;style type=&quot;text/css&quot;&gt;
            table td:nth-child(1) {
                display: none;
            }
            table th:nth-child(1) {
                display: none;
            }
        &lt;/style&gt;
    &quot;&quot;&quot;,
    unsafe_allow_html=True,
)</code></pre>
<h4>칼럼 width 조절 문제</h4>
<p>이게 제일 골때리는 문제였다.<br>검색해 보면 아래와 같은 해결책은 여러 가지 있는데, 정작 내 환경에선 적용이 안되더라.<br><a href="https://discuss.streamlit.io/t/is-there-a-way-to-specify-column-width-for-dataframe-table/333">https://discuss.streamlit.io/t/is-there-a-way-to-specify-column-width-for-dataframe-table/333</a></p>
<p>결국 해결한 방법은 여기에 적힌 세 가지 방법 중, 투명한 img 태그를 삽입하는 방법이었다.<br>이것 외엔 아무것도 안 먹히더라.<br><a href="https://stackoverflow.com/questions/36121672/set-table-column-width-via-markdown">https://stackoverflow.com/questions/36121672/set-table-column-width-via-markdown</a></p>
<pre><code class="language-python">def add_invisible_img_300(value):
    return f&quot;{value}&lt;img width=300/&gt;&quot;

new_df = msg_content.copy()
new_df[&quot;name&quot;] = new_df[&quot;name&quot;].apply(add_invisible_img_300)</code></pre>
<p>이 방법의 치명적인 단점은 두 가지.</p>
<ul>
<li>기존보다 작게는 조절 불가</li>
<li>코드와 그 결과물이 더럽다</li>
</ul>
<h4>url 칼럼이 무의미하게 많은 칸을 차지하는 문제</h4>
<p>그냥 출력하는 경우, url의 길이가 제각기 다르고, 다른 칼럼과 다르게 linebreak가 먹히지 않기에 무의미하게 많은 칸을 차지하게 된다.<br>어차피 중요한 것은 url이 아니라 링크이므로, <code>&lt;a&gt;</code>태그를 넣어서 그냥 link라는 문자열에 링크를 부여하였다.</p>
<pre><code class="language-python">def wrap_url_with_a_tag(url):
    return f&#39;&lt;a href=&quot;{url}&quot;&gt;link&lt;/a&gt;&#39;

new_df = msg_content.copy()
new_df[&quot;url&quot;] = new_df[&quot;url&quot;].apply(wrap_url_with_a_tag)</code></pre>

                        </div>
                        <br/>
                        <div class="tags">
                            #HTML #markdown #pandas #DataFrame #streamlit 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
