
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>MongoDB에서의 데이터 항목 제어</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">MongoDB에서의 데이터 항목 제어</h2>
                                <div class="box-info">
                                    <p class="category">Tech/DB・SQL</p>
                                    <p class="date">2021-05-21 17:36:00</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p data-ke-size="size16">AWS DocumentDB를 이용하게 되어서, ACID트랜잭션이라거나 데이터 항목 제어 등을 조사할 필요가 있었다.</p>
<p data-ke-size="size16">사실상 MongoDB를 쓰는 거나 마찬가지라, MongoDB의 내용 위주로 인풋을 하게 되었는데...<br />그 중, 데이터 항목 제어 관련해서 메모를 좀 해 두도록 한다.<br /><br />MongoDB는 아래와 같이 Collection에 Validator를 달아주어 각 항목의 Type이나 범위, Required 등을 제어 가능하다.</p>
<pre id="code_1621585869786" class="javascript" data-ke-language="javascript" data-ke-type="codeblock"><code>db.createCollection("students", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: [ "name", "year" ],
      properties: {
        name: {
          bsonType: "string",
          description: "String &amp; Required"
        },
        year: {
          bsonType: "int",
          minimum: 7,
          maximum: 25,
          description: "Integer &amp; Required &amp; IN 7~25"
        },
      }
    }
  }
})</code></pre>
<p data-ke-size="size16">아래와 같이, 이미 존재하는 Collection에 대해서도 Validator를 부착 가능하다.</p>
<pre id="code_1621585902574" class="javascript" data-ke-language="javascript" data-ke-type="codeblock"><code>db.runCommand( {
  collMod: "students",
  validator: { $jsonSchema: {
    bsonType: "object",
    required: [ "name", "year" ],
    properties: {
      name: {
        bsonType: "string",
        description: "must be a string and is required"
      },
      year: {
        bsonType: "int",
        minimum: 7,
        maximum: 25,
        description: "must be an integer in [ 7, 25 ] and is required"
      },
    }
  }},
  validationLevel: "moderate"
})</code></pre>
<p data-ke-size="size16">대충 이런 식으로 DocumentDB에서도 되겠거니 했는데...</p>
<p data-ke-size="size16">정작 <a href="https://docs.aws.amazon.com/documentdb/latest/developerguide/mongo-apis.html#mongo-apis-query-evaluation-operators" target="_blank" rel="noopener">DocumentDB에서는 아직 대응해주지 않고 있더라</a>.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">뭐 솔직히 데이터 넣을 때 Validation걸어서 넣으면 되니까 별 문제는 없긴 한데...</p>
<p data-ke-size="size16">ACID는 잘 해주면서 이건 안해주니까 좀 섭섭하더라.</p>
                        </div>
                        <br/>
                        <div class="tags">
                            #mongodb #AWS DocumentDB #jsonSchema #항목 제어 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
