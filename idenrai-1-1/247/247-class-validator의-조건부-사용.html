
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>class-validator의 조건부 사용</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">class-validator의 조건부 사용</h2>
                                <div class="box-info">
                                    <p class="category">Tech/JavaScript</p>
                                    <p class="date">2021-06-30 20:02:16</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p data-ke-size="size16">아래의 파라메터를 필요로 하는 API를 만들고 있다.</p>
<pre id="code_1625050153858" class="javascript" data-ke-language="javascript" data-ke-type="codeblock"><code>{
  "country": "string",
  "date": "string",
  "type": [
    "string"
  ],
  "color": [
    "string"
  ],
  "def": "string"
}</code></pre>
<p data-ke-size="size16">해당 파라메터의 Validation을 위해 class-validator를 사용하고 있는데, 여기서 조건이 한 가지.</p>
<p data-ke-size="size16">기본적으로 모든 항목에 not empty를 걸고 싶은데, type과 color는 둘 중 하나만 있어도 OK로 하고 싶다.</p>
<p data-ke-size="size16">뭐 해결방법은 아래와 같다.</p>
<pre id="code_1625050742139" class="javascript" data-ke-language="javascript" data-ke-type="codeblock"><code>import * as v from "class-validator";
import { RequestModel } from "../models/RequestModel"
import { countryCode } from '../enums/countryCode';

export class TypeColorRequestModel extends RequestModel {
    constructor(event: object, context: object) {
        super(event, context);
        this.country = this.requestParams?.country;
        this.date = this.requestParams?.date;
        this.type = this.requestParams?.type;
        this.color = this.requestParams?.color;
        this.def = this.requestParams?.def;
    }

    @v.IsNotEmpty()
    @v.IsEnum(countryCode)
    country: string;

    @v.IsNotEmpty()
    @v.IsISO8601()
    date: string;

    @v.ValidateIf(o =&gt; !o.color || o.color.length === 0 || o.type)
    @v.IsNotEmpty()
    type: string[];

    @v.ValidateIf(o =&gt; !o.type || o.type.length === 0 || o.color)
    @v.IsNotEmpty()
    color: string[];

    @v.IsNotEmpty()
    def: string;
}</code></pre>
<p data-ke-size="size16">기본적으로 이런 조건류는 ValidateIf를 걸면 만능이더라.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><b>참조</b></p>
<p data-ke-size="size16"><a href="https://github.com/typestack/class-validator#conditional-validation" target="_blank" rel="noopener">class-validator/conditional-validation</a></p>
                        </div>
                        <br/>
                        <div class="tags">
                            #validation #class-validator #ValidateIf 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
