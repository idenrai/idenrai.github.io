
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>Node.js로 파라메터 넘기기</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">Node.js로 파라메터 넘기기</h2>
                                <div class="box-info">
                                    <p class="category">Tech/JavaScript</p>
                                    <p class="date">2020-01-20 17:20:47</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p data-ke-size="size16">git push시에 Jenkins가 기동되어 Jenkinsfile을 실행하고,<br />이 Jenkinsfile에서 각종 Tool을 부르는 처리를 하였다.<br /><br />Node.js로 툴을 하나 만들었는데, 이 Tool의 결과는 Teams로 Post를 하도록 하였다<br />이 때, Jenkins Job의 결과를 URL링크로 만들어 Teams에 함께 띄우고 싶은데...<br />이를 위해선 Jenkinsfile에서 Node.js Tool을 호출할 때, 「env.BUILD_URL」을 파라메터로 보내야 한다.<br /><br />bash에서야 그냥</p>
<pre id="code_1579507528324" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>sh "bash ./path/teams-notice.sh ${env.BUILD_URL}"</code></pre>
<p data-ke-size="size16">대충 이런 식으로 적어두고</p>
<pre id="code_1579507689054" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>#!/bin/bash

# BUILD URL
BUILD_URL=$1</code></pre>
<p data-ke-size="size16">이런 식으로 받아오면 된다지만...<br />JSON에서는 어떨까 싶었다.</p>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style5" />
<p data-ke-size="size16">일단 사용하는 것은 <a href="https://nodejs.org/docs/latest/api/process.html#process_process_argv" target="_blank" rel="noopener"><b>process.argv</b></a>라는 녀석.<br />사용 방법은 비슷하다.<br />일단 Jenkinsfile에서 부를 때엔 이런 느낌.</p>
<pre id="code_1579508160505" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>pipeline {
    agent any
    tools {nodejs "node"}
    environment {
        BATCH_DIR = "./src"
    }
    stages {
        stage('Run') {
            steps {
                script {
                    LAST_STARTED = env.STAGE_NAME
                    sh "node src/main.js ${env.BUILD_URL}" 
                }
            }
        }
    }
    post {
        failure {
            echo ""
            echo "+++----- [Pipeline][Error]Failed stage : ${LAST_STARTED}"
            echo ""
        }
    }
}
</code></pre>
<p data-ke-size="size16">그리고 사용은 이런 식으로.</p>
<pre id="code_1579508195878" class="javascript" data-ke-language="javascript" data-ke-type="codeblock"><code>async function main() {
  var args = process.argv.slice(2);
  console.log(args[0]);
}</code></pre>
<p data-ke-size="size16">process.argv.slice(2)를 하면, process<span style="color: #333333;">.</span>argv의 3번째 값부터 짤라서 배열로 갖고오니까,<br />우리가 호출시에 보낸 파라메터는 이 값의 0번째에 위치하게 된다.<br />혹시 파라메터를 2개 이상 보낼 경우에도 적용 가능하다.</p>
                        </div>
                        <br/>
                        <div class="tags">
                            #node.js parameter #파라메터 넘기기 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
